# 文档样例

## 0. 整体介绍

本工程为基于览沃mid360多线雷达的自动导航小车

【结构图/流程图】

## 1. 运行环境

### 1.1 系统

ubuntu 20.04

ros1 noectic

### 1.2 依赖包

#### 1.2.1 Livox-SDK2 览沃mid360 SDK

```
# 安装Livox-SDK2
git clone https://github.com/Livox-SDK/Livox-SDK2.git
cd ./Livox-SDK2/
mkdir build
cd build
cmake .. && make -j
sudo make install
```

#### 1.2.2 nlopt

```
# 安装nlopt
git clone https://github.com/stevengj/nlopt.git
cd nlopt
mkdir build
cd build
cmake ..
make
sudo make install
```
#### 1.2.3 Sophus

```
# 安装sophus
git clone https://github.com/strasdat/Sophus.git
cd Sophus
git checkout a621ff
mkdir build
cd build
cmake ../ -DUSE_BASIC_LOGGING=ON
make
sudo make install
```
- 安装过程中直接拉取github上的代码可能有报错，在3rdparty文件夹有已修改的源码，可以直接使用。


### 1.3 功能包说明

#### 1.3.1 calibration_camera_lidar
激光雷达与相机联合标定功能包

#### 1.3.2 FAST_LIO
激光雷达惯性里程计


#### 1.3.3 FAST_LIO_LOCALIZATION
机器人重定位

#### 1.3.4 livox_ros_driver2
Livox生产的激光雷达产品的第二代驱动程序包，适用于ROS（noetic推荐）和ROS2（foxy或humble推荐）。本工程使用noetic

#### 1.3.5 sentry_nav

文件结构
```
sentry_nav
├── launch
│   ├── sentry_movebase.launch              # 采用move_base进行路径规划，避障，此launch文件用于启动导航与避障功能
│   └── sentry_test.launch
├── package.xml
├── param                                   # 导航参数在这里调整，每个参数的作用在yaml文件中有详细的注释
│   ├── base_local_planner_params.yaml
│   ├── costmap_common_params.yaml
│   ├── global_costmap_params.yaml
│   ├── global_planner_params.yaml
│   └── local_costmap_params.yaml
└── src
    ├── Trans_odom_2d.cpp
.....
```

#### 1.3.6 usb_cam
USB摄像头功能包
```
├── config
│   └── usb_cam.yml             # 摄像头相关参数配置文件
├── include
├── launch
│   ├── test_img_view.launch
│   ├── usb_cam.launch          # 用于启动USB摄像头，奥比中光RGB摄像头也可以启动，摄像头启动后可以通过rviz订阅对应话题进行可视化
│   └── usb_cam-test.launch
└── src
    ├── camera_driver.cpp
....
```

#### 1.3. yahboomcar_bringup
jetson nano与底盘MCU通信功能包
```
├── cfg
├── include
├── launch
│   .....
│   ├── yahboomcar.launch       #启动小车与地盘通信的节点，其他launch文件看需求使用，每个launch文件里面有对其功能的介绍
│   ......
├── package.xml
├── param
├── rviz
├── scripts
│   .......
│   ├── Mcnamu_driver.py        #用地盘单片机通信的实现代码
│   .......
└── src
```
 
#### 1.3. yahboomcar_ctrl
底盘控制功能包，包括手柄控制、键盘控制等功能
```
.
├── CMakeLists.txt
├── launch
│   .......
│   ├── yahboom_joy.launch           # 启动手柄控制功能，可用于建图
│   └── yahboom_keyboard.launch      # 启动键盘控制功能，可用于建图
├── package.xml
└── scripts
    ├── ......
    ├── yahboom_joy.py              # 手柄控制代码
    └── yahboom_keyboard.py         # 键盘控制代码
```

#### 1.3. sentry_tools
点云PCD文件转成栅格及速度平滑的指数移动平均（EMA）功能包
```
├── pcd2pgm_package             # 点云PCD文件转成栅格图
│   ├── pcd2pgm
│   │   ├── launch
│   │   │   ├── pcd2pgm.launch
│   │   │   └── run.launch
│   │   └── src
│   │       └── pcd2pgm.cpp
└── velocity_smoother_ema           # 用于速度平滑的指数移动平均（EMA）公式的实现。
    ├── include
    │   └── velocity_smoother_ema
    │       └── velocity_smoother_ema.hpp
    ├── launch
    │   └── velocity_smoother_ema.launch
    ├── param
    │   └── smoother.yaml
    ├── src
    │   └── velocity_smoother_ema.cpp

```
yahboomcar_description
yahboomcar_msgs
sentry_decision
robot_localization
```

```

### 1.4 运行方法

#### 1.4 构建地图
执行以下命令前需要在每个终端窗口加载环境，(如果已配置source,则不需要执行这步操作)
```
source devel/setup.bash 
conda deactivate
```
启动地图构建相关launch
```
# 启动mid360雷达
roslaunch livox_ros_driver2 msg_MID360.launch
# 启动建图
roslaunch fast_lio_localization sentry_build_map.launch 
# 启动底盘通信
roslaunch yahboomcar_bringup yahboomcar.launch
# 启动键盘控制
roslaunch yahboomcar_ctrl yahboom_keyboard.launch
# 保存栅格地图
rosrun map_server map_saver map:=/projected_map -f /home/jetson/ros1_ws/src/FAST_LIO/PCD/scans
```
#### 1.4 导航与避障(基于icp重定位)
执行以下命令前需要在每个终端窗口加载环境，(如果已配置source,则不需要执行这步操作)
```
source devel/setup.bash 
```
检查在fast_lio/PCD下中保存的2d地图scans.yaml,确保其中参数origin[x,y,yaw]不能是nan，如果yaw是nan的话，将其设置为0.

启动导航避障相关launch
```
# 启动mid360雷达
roslaunch livox_ros_driver2 msg_MID360.launch
# 对机器人进行定位操作
roslaunch fast_lio_localization sentry_localize.launch
# 使用rviz给小车一个初始位置，其实就是让小车的雷达点云与栅格地图对齐 或者通过以下命令进行位置初始化
rosrun fast_lio_localization publish_initial_pose.py 0 0 0 0 0 0

roslaunch sentry_nav sentry_movebase.launch



```


```
# 模块一启动
./run_module1.sh

# 模块二启动
./run_module2.sh
```

### 2. 功能模块

### 2.1 模块1

[代码所在位置](path/to/file)

模块介绍

参数简介，调整方法

【流程图】

### 2.2 模块2

[代码所在位置](path/to/file)

模块介绍

参数简介，调整方法

【流程图】
